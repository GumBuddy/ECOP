<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAKURL Security - Protección de Enlaces</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 800px;
            margin-top: 50px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #6c5ce7;
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 600;
        }
        .btn-primary {
            background-color: #6c5ce7;
            border-color: #6c5ce7;
        }
        .btn-primary:hover {
            background-color: #5a4fcf;
            border-color: #5a4fcf;
        }
        .result-container {
            display: none;
            margin-top: 20px;
        }
        .tab-content {
            padding: 20px;
        }
        .file-drop-area {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 30px;
            border: 2px dashed #6c5ce7;
            border-radius: 10px;
            transition: 0.2s;
            background-color: #f8f7ff;
            margin-bottom: 20px;
        }
        .file-drop-area:hover {
            background-color: #f0efff;
        }
        .file-drop-area.is-active {
            background-color: #e8e7ff;
        }
        .file-msg {
            font-size: 16px;
            font-weight: 500;
            color: #6c5ce7;
            margin-bottom: 10px;
        }
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 100%;
            cursor: pointer;
            opacity: 0;
        }
        .error-message {
            display: none;
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-weight: 500;
        }
        .error-key {
            background-color: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }
        .error-url {
            background-color: #fff8e1;
            color: #ff8f00;
            border-left: 4px solid #ff8f00;
        }
        .success-message {
            display: none;
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            background-color: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
            font-weight: 500;
        }
        .key-info {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background-color: #e3f2fd;
            border-left: 4px solid #1976d2;
        }
        .key-info h5 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        .download-btn {
            background-color: #1976d2;
            border-color: #1976d2;
            margin-top: 10px;
        }
        .download-btn:hover {
            background-color: #1565c0;
            border-color: #1565c0;
        }
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        .logo-icon {
            width: 60px;
            height: 60px;
            background-color: #6c5ce7;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-center mb-4">
            <div class="logo-container">
                <div class="logo-icon">RAK</div>
            </div>
            <h1 class="display-4 fw-bold" style="color: #6c5ce7;">RAKURL Security</h1>
            <p class="lead">RANDOM ACCESS KEY URL SECURITY</p>
        </div>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="protect-tab" data-bs-toggle="tab" data-bs-target="#protect" type="button" role="tab" aria-controls="protect" aria-selected="true">Proteger Enlace</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="access-tab" data-bs-toggle="tab" data-bs-target="#access" type="button" role="tab" aria-controls="access" aria-selected="false">Acceder a Enlace</button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <!-- Pestaña para proteger enlaces -->
            <div class="tab-pane fade show active" id="protect" role="tabpanel" aria-labelledby="protect-tab">
                <div class="card">
                    <div class="card-header">
                        Proteger un enlace
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="urlInput" class="form-label">URL a proteger</label>
                            <input type="url" class="form-control" id="urlInput" placeholder="https://ejemplo.com" required="">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Generación de clave</label>
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle-fill me-2"></i>Al proteger el enlace, RAKURL Security generará automáticamente un archivo .key con una combinación de números aleatorios que servirá como clave para descifrar el enlace.
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" id="protectBtn">Proteger Enlace</button>
                        
                        <div class="error-message error-url" id="protectErrorUrl">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>La URL ingresada no es válida. Por favor, verifica e intenta nuevamente.
                        </div>
                        
                        <div class="success-message" id="protectSuccess">
                            <i class="bi bi-check-circle-fill me-2"></i>¡Enlace protegido exitosamente con RAKURL Security! Copia el enlace generado y descarga tu archivo clave.
                        </div>
                        
                        <div class="key-info" id="keyInfo">
                            <h5><i class="bi bi-key-fill me-2"></i>Archivo de Clave Generado</h5>
                            <p>RAKURL Security ha generado un archivo .key con 12000 números aleatorios binarios. Este archivo es necesario para acceder al enlace protegido.</p>
                            <button class="btn download-btn" id="downloadKeyBtn">
                                <i class="bi bi-download me-2"></i>Descargar Archivo .key
                            </button>
                        </div>
                        
                        <div class="result-container" id="protectResult">
                            <hr>
                            <h5>Enlace Protegido por RAKURL Security</h5>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="protectedUrl" readonly="">
                                <button class="btn btn-outline-secondary" type="button" id="copyProtectedUrl">Copiar</button>
                            </div>
                            <div class="alert alert-warning">
                                <strong>Importante:</strong> Guarda este enlace protegido y descarga el archivo .key generado. Necesitarás ambos para acceder al enlace original.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pestaña para acceder a enlaces -->
            <div class="tab-pane fade" id="access" role="tabpanel" aria-labelledby="access-tab">
                <div class="card">
                    <div class="card-header">
                        Acceder a un enlace protegido
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="protectedUrlInput" class="form-label">Enlace protegido</label>
                            <input type="text" class="form-control" id="protectedUrlInput" placeholder="Pega aquí el enlace protegido por RAKURL Security" required="">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Cargar archivo clave (.key)</label>
                            <div class="file-drop-area" id="fileDropAreaAccess">
                                <span class="file-msg">Arrastra y suelta tu archivo .key aquí</span>
                                <span>o</span>
                                <button class="btn btn-sm btn-outline-primary mt-2">Seleccionar archivo .key</button>
                                <input class="file-input" type="file" id="keyFileInputAccess" accept=".key">
                            </div>
                            <div class="form-text">Usa el archivo .key que generó RAKURL Security al proteger el enlace.</div>
                        </div>
                        
                        <button class="btn btn-primary" id="accessBtn">Acceder</button>
                        
                        <div class="error-message error-url" id="accessErrorUrl">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>La URL proporcionada no coincide con ningún enlace protegido por RAKURL Security. Verifica la URL e intenta nuevamente.
                        </div>
                        
                        <div class="error-message error-key" id="accessErrorKey">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>La llave ingresada es incorrecta o el archivo no es un .key válido. Asegúrate de usar el archivo .key correcto generado por RAKURL Security.
                        </div>
                        
                        <div class="success-message" id="accessSuccess">
                            <i class="bi bi-check-circle-fill me-2"></i>¡Acceso concedido por RAKURL Security! El enlace original ha sido descifrado correctamente.
                        </div>
                        
                        <div class="result-container" id="accessResult">
                            <hr>
                            <h5>Enlace Original</h5>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="originalUrl" readonly="">
                                <button class="btn btn-outline-secondary" type="button" id="copyOriginalUrl">Copiar</button>
                                <button class="btn btn-outline-primary" type="button" id="visitOriginalUrl">Visitar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                ¿Cómo funciona RAKURL Security?
            </div>
            <div class="card-body">
                <p>RAKURL Security (RANDOM ACCESS KEY URL SECURITY) es una aplicación que te permite proteger y cifrar enlaces.</p>
                <ol>
                    <li><strong>Proteger un enlace:</strong> Ingresa la URL que deseas proteger. RAKURL Security generará automáticamente un archivo .key con números aleatorios.</li>
                    <li><strong>Generar enlace protegido:</strong> RAKURL Security creará un enlace protegido que contiene la URL original cifrada con el archivo .key generado.</li>
                    <li><strong>Acceder al enlace:</strong> Para acceder al enlace original, necesitarás el enlace protegido y el archivo .key que generó RAKURL Security al protegerlo.</li>
                </ol>
                <p class="mb-0"><strong>Nota:</strong> Toda la encriptación y desencriptación se realiza localmente en tu dispositivo. No se envía ninguna información a servidores externos, esto es completamente anónimo.</p>
            </div>
        </div>
    </div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar área de arrastrar y soltar para acceso
            setupFileDropArea('fileDropAreaAccess', 'keyFileInputAccess');
            
            // Botón para proteger enlace
            document.getElementById('protectBtn').addEventListener('click', protectUrl);
            
            // Botón para acceder a enlace
            document.getElementById('accessBtn').addEventListener('click', accessUrl);
            
            // Botones para copiar
            document.getElementById('copyProtectedUrl').addEventListener('click', function() {
                copyToClipboard('protectedUrl');
            });
            
            document.getElementById('copyOriginalUrl').addEventListener('click', function() {
                copyToClipboard('originalUrl');
            });
            
            // Botón para visitar enlace original
            document.getElementById('visitOriginalUrl').addEventListener('click', function() {
                const url = document.getElementById('originalUrl').value;
                if (url) {
                    window.open(url, '_blank');
                }
            });
            
            // Botón para descargar archivo .key
            document.getElementById('downloadKeyBtn').addEventListener('click', downloadKeyFile);
        });
        
        function setupFileDropArea(dropAreaId, fileInputId) {
            const dropArea = document.getElementById(dropAreaId);
            const fileInput = document.getElementById(fileInputId);
            
            // Prevenir comportamientos por defecto
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            // Resaltar área al arrastrar
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('is-active');
            }
            
            function unhighlight() {
                dropArea.classList.remove('is-active');
            }
            
            // Manejar archivos soltados
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    // Verificar si el archivo tiene extensión .key
                    const file = files[0];
                    if (!file.name.toLowerCase().endsWith('.key')) {
                        alert('Por favor, selecciona un archivo con extensión .key');
                        return;
                    }
                    
                    fileInput.files = files;
                    updateFileDisplay(dropArea, file.name);
                }
            }
            
            // Manejar selección de archivo
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    if (!file.name.toLowerCase().endsWith('.key')) {
                        alert('Por favor, selecciona un archivo con extensión .key');
                        this.value = ''; // Limpiar el input
                        return;
                    }
                    updateFileDisplay(dropArea, file.name);
                }
            });
        }
        
        function updateFileDisplay(dropArea, fileName) {
            const fileMsg = dropArea.querySelector('.file-msg');
            fileMsg.textContent = `Archivo seleccionado: ${fileName}`;
        }
        
        // Variable global para almacenar el archivo .key generado
        let generatedKeyFile = null;
        
        // Función para generar un archivo .key con 12000 números aleatorios binarios
        function generateKeyFile() {
            // Crear un array de 12000 bytes aleatorios
            const keyArray = new Uint8Array(12000);
            window.crypto.getRandomValues(keyArray);
            
            // Crear un blob con los datos
            const blob = new Blob([keyArray], { type: 'application/octet-stream' });
            
            // Crear un nombre de archivo único
            const timestamp = new Date().getTime();
            const fileName = `rakurl_key_${timestamp}.key`;
            
            // Almacenar el archivo para descarga posterior
            generatedKeyFile = {
                blob: blob,
                name: fileName,
                data: keyArray
            };
            
            return generatedKeyFile;
        }
        
        // Función para descargar el archivo .key
        function downloadKeyFile() {
            if (!generatedKeyFile) {
                alert('No hay ningún archivo .key para descargar');
                return;
            }
            
            // Crear una URL para el blob
            const url = URL.createObjectURL(generatedKeyFile.blob);
            
            // Crear un enlace temporal para la descarga
            const a = document.createElement('a');
            a.href = url;
            a.download = generatedKeyFile.name;
            document.body.appendChild(a);
            a.click();
            
            // Limpiar
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
        
        // Función para obtener la clave a partir de un archivo
        async function getFileAsKey(fileInput) {
            return new Promise((resolve, reject) => {
                if (!fileInput.files || fileInput.files.length === 0) {
                    reject(new Error('No se ha seleccionado ningún archivo'));
                    return;
                }
                
                const file = fileInput.files[0];
                
                // Verificar si el archivo tiene extensión .key
                if (!file.name.toLowerCase().endsWith('.key')) {
                    reject(new Error('El archivo debe tener extensión .key'));
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    // Convertir el contenido del archivo a una cadena hexadecimal
                    const arrayBuffer = event.target.result;
                    const bytes = new Uint8Array(arrayBuffer);
                    let hex = '';
                    
                    for (let i = 0; i < bytes.length; i++) {
                        hex += bytes[i].toString(16).padStart(2, '0');
                    }
                    
                    // Usar solo los primeros 256 caracteres como clave
                    resolve(hex.substring(0, 256));
                };
                
                reader.onerror = function() {
                    reject(new Error('Error al leer el archivo'));
                };
                
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Función para obtener la clave a partir de datos binarios
        function getDataAsKey(data) {
            let hex = '';
            
            for (let i = 0; i < data.length; i++) {
                hex += data[i].toString(16).padStart(2, '0');
            }
            
            // Usar solo los primeros 256 caracteres como clave
            return hex.substring(0, 256);
        }
        
        async function protectUrl() {
            const urlInput = document.getElementById('urlInput');
            const resultContainer = document.getElementById('protectResult');
            const errorUrl = document.getElementById('protectErrorUrl');
            const successMsg = document.getElementById('protectSuccess');
            const keyInfo = document.getElementById('keyInfo');
            
            // Ocultar mensajes anteriores
            resultContainer.style.display = 'none';
            errorUrl.style.display = 'none';
            successMsg.style.display = 'none';
            keyInfo.style.display = 'none';
            
            // Validar URL
            if (!urlInput.value) {
                errorUrl.style.display = 'block';
                return;
            }
            
            try {
                // Generar archivo .key
                const keyFile = generateKeyFile();
                
                // Obtener clave del archivo generado
                const key = getDataAsKey(keyFile.data);
                
                // Cifrar la URL
                const encrypted = CryptoJS.AES.encrypt(urlInput.value, key).toString();
                
                // Crear URL protegida (usando la URL actual como base)
                const protectedUrl = `${window.location.href.split('#')[0]}#${encodeURIComponent(encrypted)}`;
                
                // Mostrar resultado
                document.getElementById('protectedUrl').value = protectedUrl;
                resultContainer.style.display = 'block';
                successMsg.style.display = 'block';
                keyInfo.style.display = 'block';
                
            } catch (error) {
                console.error('Error al proteger la URL:', error);
                alert('Ocurrió un error al proteger la URL con RAKURL Security. Por favor, intenta nuevamente.');
            }
        }
        
        async function accessUrl() {
            const protectedUrlInput = document.getElementById('protectedUrlInput');
            const keyFileInput = document.getElementById('keyFileInputAccess');
            const resultContainer = document.getElementById('accessResult');
            const errorUrl = document.getElementById('accessErrorUrl');
            const errorKey = document.getElementById('accessErrorKey');
            const successMsg = document.getElementById('accessSuccess');
            
            // Ocultar mensajes anteriores
            resultContainer.style.display = 'none';
            errorUrl.style.display = 'none';
            errorKey.style.display = 'none';
            successMsg.style.display = 'none';
            
            // Validar URL protegida
            if (!protectedUrlInput.value) {
                errorUrl.style.display = 'block';
                return;
            }
            
            try {
                // Extraer el hash de la URL
                let encrypted;
                if (protectedUrlInput.value.includes('#')) {
                    encrypted = decodeURIComponent(protectedUrlInput.value.split('#')[1]);
                } else {
                    // Si no hay hash, asumir que toda la URL es el texto cifrado
                    encrypted = protectedUrlInput.value;
                }
                
                if (!encrypted) {
                    errorUrl.style.display = 'block';
                    return;
                }
                
                // Obtener clave del archivo
                const key = await getFileAsKey(keyFileInput);
                
                // Descifrar la URL
                const decrypted = CryptoJS.AES.decrypt(encrypted, key);
                const originalUrl = decrypted.toString(CryptoJS.enc.Utf8);
                
                if (!originalUrl) {
                    errorKey.style.display = 'block';
                    return;
                }
                
                // Mostrar resultado
                document.getElementById('originalUrl').value = originalUrl;
                resultContainer.style.display = 'block';
                successMsg.style.display = 'block';
                
            } catch (error) {
                console.error('Error al acceder a la URL:', error);
                errorKey.style.display = 'block';
            }
        }
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999); // Para dispositivos móviles
            
            navigator.clipboard.writeText(element.value)
                .then(() => {
                    // Cambiar temporalmente el texto del botón
                    const btn = document.querySelector(`#${elementId.replace('Url', 'Url')} + button`);
                    const originalText = btn.textContent;
                    btn.textContent = '¡Copiado!';
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                    }, 2000);
                })
                .catch(err => {
                    console.error('Error al copiar al portapapeles: ', err);
                });
        }
        
        // Comprobar si hay un enlace protegido en la URL actual
        window.addEventListener('load', function() {
            const hash = window.location.hash;
            if (hash && hash.length > 1) {
                // Cambiar a la pestaña de acceso
                document.getElementById('access-tab').click();
                
                // Rellenar el campo de enlace protegido
                document.getElementById('protectedUrlInput').value = window.location.href;
            }
        });
    </script>

</body></html>
